<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calendario NPC Argentina 2026</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- Librerías -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { background-color: #000; font-family: -apple-system, system-ui, sans-serif; overflow: hidden; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- CONFIGURACIÓN FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyB30MYN6crHgI8LUf-WMSuuWgng_bqVi9A",
            authDomain: "npc-argentina-2026.firebaseapp.com",
            projectId: "npc-argentina-2026",
            storageBucket: "npc-argentina-2026.firebasestorage.app",
            messagingSenderId: "133481912186",
            appId: "1:133481912186:web:6aedcd68fb0df7906128c3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        const { useState, useEffect } = React;
        const LOGO_URL = "https://github.com/user-attachments/assets/e2a6343a-023e-45d3-a8e3-f5ebcc192d25"; 

        // --- DATOS INICIALES (Respaldo) ---
        const INITIAL_DATA = [
            { id: 1, dateDay: "12", dateMonth: "ABR", name: "Open Capital", location: "CABA", league: "REGIONAL", highlight: false, order: 1 },
            { id: 2, dateDay: "10", dateMonth: "MAY", name: "Rock Hard Physique", location: "CABA", league: "REGIONAL", highlight: false, order: 2 },
            { id: 3, dateDay: "14", dateMonth: "JUN", name: "ROCKY", location: "CABA", league: "REGIONAL", highlight: false, order: 3 },
            { id: 4, dateDay: "09", dateMonth: "AGO", name: "Salta Muscleshow", location: "Salta", league: "REGIONAL", highlight: false, order: 4 },
            { id: 5, dateDay: "14-16", dateMonth: "AGO", name: "ARGENTINO NATURALS + NPC", subtext: "Sur Pro Cup (Wellness + Classic PRO)", location: "ARGENTINA", league: "PRO QUALIFIER / PRO", highlight: true, order: 5 },
            { id: 6, dateDay: "30", dateMonth: "AGO", name: "La Plata Muscleshow", location: "La Plata", league: "REGIONAL", highlight: false, order: 6 },
            { id: 7, dateDay: "06", dateMonth: "SEP", name: "Córdoba Muscleshow", location: "Córdoba", league: "REGIONAL", highlight: false, order: 7 },
            { id: 8, dateDay: "13", dateMonth: "SEP", name: "EXCALIBUR", location: "CABA", league: "REGIONAL", highlight: false, order: 8 },
            { id: 9, dateDay: "04", dateMonth: "OCT", name: "Medal of Honor", location: "CABA", league: "REGIONAL", highlight: false, order: 9 },
            { id: 10, dateDay: "25", dateMonth: "OCT", name: "Fortress Weekend", location: "Santa Fe", league: "REGIONAL", highlight: false, order: 10 },
            { id: 11, dateDay: "01", dateMonth: "NOV", name: "IRONMAN CUP", location: "CABA", league: "REGIONAL", highlight: false, order: 11 },
            { id: 12, dateDay: "14-15", dateMonth: "NOV", name: "Mar del Plata Muscleshow", location: "Mar del Plata", league: "REGIONAL", highlight: false, order: 12 },
            { id: 13, dateDay: "29", dateMonth: "NOV", name: "NPC Mr. Salta", location: "Salta", league: "REGIONAL", highlight: false, order: 13 },
            { id: 14, dateDay: "06", dateMonth: "DIC", name: "B.A Cup", location: "CABA", league: "REGIONAL", highlight: false, order: 14 },
            { id: 15, dateDay: "12-13", dateMonth: "DIC", name: "NATURALS NATIONALS + WORLD", subtext: "Sur Pro Cup (Bikini + 212 PRO)", location: "CABA", league: "PRO QUALIFIER / PRO", highlight: true, order: 15 },
        ];

        // --- ICONOS ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Icons = {
            MapPin: (p) => <Icon path={<><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></>} {...p} />,
            Search: (p) => <Icon path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} {...p} />,
            Heart: (p) => <Icon path={<path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5 4.5 2-1.5 3.5-2.71 2-5.5A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>} {...p} />,
            Calendar: (p) => <Icon path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} {...p} />,
            User: (p) => <Icon path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>} {...p} />,
            Home: (p) => <Icon path={<><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></>} {...p} />,
            Google: (p) => <Icon path={<path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-6v-4h4v4h-4z"/>} {...p} />,
            Download: (p) => <Icon path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></>} {...p} />,
            X: (p) => <Icon path={<><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>} {...p} />,
            Apple: (p) => <Icon path={<path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"/>} {...p} />, 
            Android: (p) => <Icon path={<path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z"/>} {...p} />,
            MoreVertical: (p) => <Icon path={<><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></>} {...p} />,
            Share: (p) => <Icon path={<><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></>} {...p} />
        };

        const App = () => {
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('home');
            const [savedIds, setSavedIds] = useState([]);
            const [user, setUser] = useState(null);
            const [showInstallModal, setShowInstallModal] = useState(false);
            const [installPrompt, setInstallPrompt] = useState(null);
            const [isIOS, setIsIOS] = useState(false);

            useEffect(() => {
                const isIosDevice = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                setIsIOS(isIosDevice);

                // Mostrar modal solo si no está instalada
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
                if (!isStandalone) {
                    setTimeout(() => setShowInstallModal(true), 2000);
                }

                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setInstallPrompt(e);
                });

                const loadData = async () => {
                    try {
                        const q = query(collection(db, "events"), orderBy("order", "asc"));
                        const snap = await getDocs(q);
                        if (!snap.empty) {
                            setEvents(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                        } else {
                            // Si falla la conexión o está vacía, mostramos los iniciales
                            setEvents(INITIAL_DATA); 
                        }
                    } catch (e) {
                        console.error("Offline o error de permisos, usando datos locales");
                        setEvents(INITIAL_DATA);
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();

                const saved = localStorage.getItem('npc_arg_favorites');
                if (saved) setSavedIds(JSON.parse(saved));
                return onAuthStateChanged(auth, setUser);
            }, []);

            const handleLogin = async () => {
                try {
                    await signInWithPopup(auth, new GoogleAuthProvider());
                } catch (error) {
                    alert("Error login: Habilita Google Auth en Firebase Console.");
                }
            };

            const toggleSave = (id) => {
                const newSaved = savedIds.includes(id) ? savedIds.filter(s => s !== id) : [...savedIds, id];
                setSavedIds(newSaved);
                localStorage.setItem('npc_arg_favorites', JSON.stringify(newSaved));
            };

            const triggerInstall = () => {
                if (installPrompt) {
                    installPrompt.prompt();
                    setInstallPrompt(null);
                    setShowInstallModal(false);
                }
            };

            const filteredEvents = events.filter(t => activeTab === 'saved' ? savedIds.includes(t.id) : true);

            return (
                <div className="flex justify-center min-h-screen bg-black text-white">
                    <div className="w-full max-w-md h-[100dvh] bg-neutral-950 relative flex flex-col shadow-2xl border-x border-neutral-900">
                        
                        {/* HEADER */}
                        <div className="px-5 pt-6 pb-4 bg-neutral-900/80 backdrop-blur-md border-b border-white/5 sticky top-0 z-30">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-3">
                                    <img src={LOGO_URL} className="w-10 h-10 rounded-full object-cover shadow-lg bg-neutral-800" />
                                    <div>
                                        <h1 className="font-bold text-lg leading-none">NPC Argentina</h1>
                                        <span className="text-xs text-blue-400 font-medium tracking-wide">Temporada 2026</span>
                                    </div>
                                </div>
                                {/* Icono de admin eliminado */}
                            </div>
                        </div>

                        {/* CONTENIDO */}
                        <div className="flex-1 overflow-y-auto px-4 py-4 space-y-3 pb-24 scrollbar-hide">
                            {activeTab === 'profile' ? (
                                <div className="flex flex-col items-center justify-center h-full space-y-6 fade-in p-6">
                                    {user ? (
                                        <>
                                            <img src={user.photoURL} className="w-24 h-24 rounded-full border-4 border-neutral-800" />
                                            <h2 className="text-xl font-bold">Hola, {user.displayName.split(' ')[0]}!</h2>
                                            <button onClick={() => signOut(auth)} className="w-full py-3 bg-red-900/20 text-red-400 rounded-xl font-bold">Cerrar Sesión</button>
                                        </>
                                    ) : (
                                        <>
                                            <Icons.User size={40} className="text-neutral-600" />
                                            <h2 className="text-xl font-bold text-center">Crea tu cuenta</h2>
                                            <button onClick={handleLogin} className="w-full py-4 bg-white text-black rounded-xl font-bold flex items-center justify-center gap-3">
                                                <Icons.Google size={20} /> Ingresar con Google
                                            </button>
                                        </>
                                    )}
                                </div>
                            ) : (
                                <>
                                    {loading && <div className="text-center py-10 text-neutral-500 animate-pulse">Cargando...</div>}
                                    {!loading && filteredEvents.length === 0 && <div className="text-center py-20 text-neutral-600">No hay eventos.</div>}
                                    {filteredEvents.map((item) => (
                                        <div key={item.id} className="bg-neutral-900/50 rounded-2xl p-3 border border-neutral-800 relative fade-in">
                                            <div className="flex gap-4">
                                                <div className={`w-16 h-16 rounded-xl flex flex-col items-center justify-center shrink-0 shadow-lg ${item.highlight ? 'bg-gradient-to-br from-yellow-500 to-yellow-600 text-black' : 'bg-neutral-800 text-neutral-400'}`}>
                                                    <span className="text-xl font-bold leading-none">{item.dateDay.split('-')[0]}</span>
                                                    <span className="text-[10px] font-black uppercase mt-1">{item.dateMonth}</span>
                                                </div>
                                                <div className="flex-1 min-w-0 flex flex-col justify-center">
                                                    <div className="flex justify-between items-start">
                                                        <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded uppercase mb-1.5 inline-block tracking-wider ${item.highlight ? 'bg-red-900/30 text-red-400 border border-red-900/50' : 'bg-neutral-800 text-neutral-500'}`}>
                                                            {item.league}
                                                        </span>
                                                        <button onClick={(e) => { e.stopPropagation(); toggleSave(item.id); }} className="p-1 -mt-1 -mr-1 text-neutral-600 hover:text-red-500 transition-colors active:scale-125">
                                                            <Icons.Heart size={20} className={savedIds.includes(item.id) ? "fill-red-500 text-red-500" : ""} />
                                                        </button>
                                                    </div>
                                                    <h3 className={`font-bold text-sm leading-tight mb-1 truncate ${item.highlight ? 'text-yellow-400' : 'text-white'}`}>
                                                        {item.name}
                                                    </h3>
                                                    <div className="flex items-center gap-1 text-neutral-500 text-xs mt-auto">
                                                        <Icons.MapPin size={12} /> <span className="truncate">{item.location}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </>
                            )}
                        </div>

                        {/* --- VENTANA EMERGENTE DE INSTALACIÓN --- */}
                        {showInstallModal && (
                            <div className="absolute inset-0 z-50 bg-black/90 backdrop-blur-md flex items-end fade-in">
                                <div className="bg-neutral-900 w-full rounded-t-3xl p-6 pb-10 border-t border-neutral-700 slide-up relative">
                                    <button onClick={() => setShowInstallModal(false)} className="absolute top-4 right-4 text-gray-500 hover:text-white"><Icons.X size={24} /></button>
                                    
                                    <div className="flex gap-4 items-center mb-6">
                                        <div className="w-14 h-14 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">NPC</div>
                                        <div>
                                            <h3 className="text-white font-bold text-lg">Instalar App 2026</h3>
                                            <p className="text-neutral-400 text-xs">Acceso directo sin internet.</p>
                                        </div>
                                    </div>

                                    {installPrompt ? (
                                        <button 
                                            onClick={triggerInstall}
                                            className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg mb-4"
                                        >
                                            Instalar Ahora
                                        </button>
                                    ) : (
                                        <div className="bg-neutral-800/50 p-4 rounded-xl border border-neutral-700 mb-4 text-sm text-gray-300">
                                            {isIOS ? (
                                                <div className="space-y-3">
                                                    <p className="font-bold text-white mb-2">Pasos para iPhone:</p>
                                                    <div className="flex items-center gap-3">
                                                        <Icons.Share className="text-blue-400"/> <span>1. Toca <b>Compartir</b> abajo.</span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-xl leading-none">+</span> <span>2. Elige <b>Agregar al inicio</b>.</span>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="space-y-3">
                                                    <p className="font-bold text-white mb-2">Pasos para Android:</p>
                                                    <div className="flex items-center gap-3">
                                                        <Icons.MoreVertical className="text-gray-400"/> <span>1. Toca los <b>3 puntos</b> arriba.</span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <Icons.Download className="text-gray-400"/> <span>2. Elige <b>Instalar aplicación</b>.</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <button onClick={() => setShowInstallModal(false)} className="w-full text-neutral-500 font-medium py-2 text-sm">Ahora no</button>
                                </div>
                            </div>
                        )}

                        {/* NAVBAR */}
                        <div className="h-[80px] bg-neutral-950/90 backdrop-blur-lg border-t border-neutral-900 absolute bottom-0 w-full flex justify-around items-start pt-4 z-40">
                            <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 w-20 ${activeTab === 'home' ? 'text-blue-500' : 'text-neutral-600'}`}><Icons.Home size={24} strokeWidth={activeTab === 'home'?3:2} /><span className="text-[10px]">Inicio</span></button>
                            <button onClick={() => setActiveTab('saved')} className={`flex flex-col items-center gap-1 w-20 ${activeTab === 'saved' ? 'text-blue-500' : 'text-neutral-600'}`}><Icons.Calendar size={24} strokeWidth={activeTab === 'saved'?3:2} /><span className="text-[10px]">Agenda</span></button>
                            <button onClick={() => setActiveTab('profile')} className={`flex flex-col items-center gap-1 w-20 ${activeTab === 'profile' ? 'text-blue-500' : 'text-neutral-600'}`}><Icons.User size={24} strokeWidth={activeTab === 'profile'?3:2} /><span className="text-[10px]">Perfil</span></button>
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
